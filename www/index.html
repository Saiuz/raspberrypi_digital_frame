<!DOCTYPE html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<html>
<body>
<h2></h2>
<p id="main"></p>

<script>
var etag="";
var d = new Date();
var n = d.getDay();
var h = d.getHours();


function on_off_hour() {
  var xmldays = new XMLHttpRequest();
  xmldays.open("GET", "http://frame/api/days/", true);
  xmldays.send();

	xmldays.onreadystatechange = function() {

  	if (this.readyState == 4 ) {
      var myDays = JSON.parse(this.responseText);
      var etag=myDays._items[n-1]._etag;
      var hours=myDays._items[n-1].hours;
      var MyDaysNow=myDays._items[n-1].hours[h];
      console.log(MyDaysNow);
      if ( MyDaysNow == "1" ){
        HoursBase=set_in_str(hours, h, '0') 
        document.getElementById("main").innerHTML ="<br><b>Screen On - Turning off</br>";
     }
      else {
        HoursBase=set_in_str(hours, h, '1') 
	      document.getElementById("main").innerHTML ="<br> Turning screen on</br>";
      }
        post_json(HoursBase,etag,n);
  }
};
};

function post_json(hours,etag,n) {
  var sendData = $('#data').val();
  console.log(hours+" "+etag+" "+n);
  $.ajax({
    headers: {
      'If-Match': etag,
      'Content-Type':'application/json'
      },
      url: 'http://frame/api/days/'+n,
      type: 'PATCH',   
      data: JSON.stringify({ 'hours': hours,}),
      success: function () {
        set_refresh()
         }
        });
};

function get_etag(){



}


function set_refresh(){
  var sendData = $('#data').val();
  $.ajax({
    headers: {
      'If-Match': etag,
      'Content-Type':'application/json'
      },
      url: 'http://frame/api/config/10/',
      type: 'PATCH',   
      data: JSON.stringify({"id":'10', "key":'reread', "value": 'true' }),
      success: function () {
         }
        });
};

function set_in_str(HoursString, place, set) {
  let HoursBase=""
  for ( var f = 0; f<HoursString.length; f++) {
    if ( f != place ){
    HoursBase += HoursString.charAt(f);
    }
    else{ 
    HoursBase += set;
    }
  }
  return (HoursBase);
}

</script>

<!DOCTYPE html>
<head>
<title>The Frame</title>
</head>
<body>

<button onclick="on_off_hour()">Screen on/off</button>

<!--
<button>Send an HTTP POST request to a page and get the result back</button>
<table id="mixed">
<tr><th>01</th><th>02</th><th>03</th></tr>
</table>
--!>
</body>
</html>
