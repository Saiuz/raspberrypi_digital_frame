<!DOCTYPE html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

</head>
<html>
<body>
<h2></h2>
<p id="main"></p>

<script>
function on_off_hour() {
  console.log('Starting function on/off');
  get_DayObject();
};

function get_DayObject() {
  var d = new Date();
  var Today = d.getDay()
  var NowHour = d.getHours(); 
  console.log('Now is day '+Today+' hour '+NowHour);
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200) {
    DisplayDay(this,Today,NowHour);
    }
  };
xhttp.open("GET", "http://frame/api/days/", true);
xhttp.send();
};



function DisplayDay(Days,Today,NowHour){
//  console.log(JSON.parse(Days.responseText)._items[0]._etag);
//  console.log(Today);
  
  var Hours=JSON.parse(Days.responseText)._items[Today-1].hours;
  State=Hours[NowHour]
  if ( State == "1" ){
    document.getElementById("main").innerHTML ="<br><b>Screen is On</br>";
    State=0;
    }
  else{
    document.getElementById("main").innerHTML ="<br><b>Screen is Off</br>";
    State=1;
  };

  var NewHours=Hours; 
//  console.log(State);
//  console.log(Hours.length);
  console.log(NewHours);

  
  update_day(Days,NewHours,Today)
}

function update_day(Days,NewHours,Today){
  
  var Etag=JSON.parse(Days.responseText)._items[Today]._etag;
  console.log(NewHours);
  var sendData = $('#data').val();

  $.ajax({
    headers: {
      'If-Match': Etag,
      'Content-Type':'application/json'
      },
      url: 'http://frame/api/days/'+(Today+1),
      type: 'PATCH',   
      data: JSON.stringify({ 'hours': NewHours,}),
      success: function () {
         }
        });

}



</script>

<!DOCTYPE html>
<head>
<title>The Frame</title>
</head>
<body>

<button onclick="on_off_hour()">Screen on/off</button>

<!--
<button>Send an HTTP POST request to a page and get the result back</button>
<table id="mixed">
<tr><th>01</th><th>02</th><th>03</th></tr>
</table>
--!>
</body>
</html>
